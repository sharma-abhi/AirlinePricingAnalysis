---
title: "Assignment4_report"
author: "Afan Ahmad Khan, Abhijeet Sharma"
date: "February 13, 2016"
output: pdf_document
---
# Results

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='hide'}
# Hide the code and results from the report. Just display plot in the end.

# Load required packages
library(ggplot2)
# Function to read in command line arguments , takes a character vector of
# arguments supplied after --args , reads the 2nd Map Reduce output file
args <- commandArgs(trailingOnly = TRUE)

# Reads the first argument as loads it into variable - filename
outputPath <- args[1]
bestAirline <- args[2]
nValue <- args[3]
nString <- paste(" and nValue=", nValue, sep="")
outFiles <- dir(outputPath, pattern='part-r-', full.names = TRUE)

# Initialize an empty dataframe
all.df <- data.frame()
# Reads in the content of the csv files into a dataframe .The contents are
# tab-separated and the column headers are not included
for (fileName in outFiles){
  df <- read.csv(file = fileName, sep="\t", header = FALSE)
  all.df <- rbind(all.df, df)
}

# Set the names of the character vector as Year, Week and Median Price
names(all.df) <- c("Year","Week", "MedianPrice")

# Setting the 53rd week to 52
all.df$Week[all.df$Week == 53] <- 52
# Making a new column in the dataframe by combining the year and week value, separated by -
all.df$Year_Week = paste(all.df$Year,all.df$Week,sep="-")
all.df$Date <- as.Date(paste(all.df$Year_Week,1), "%Y-%U %u")
```

Following graph shows the median price for each week of the least expensive carrier for the entire
dataset

```{r echo=FALSE}
# Display plot in the report

# Construct a plot with Year_Week on X-axis and Median Price on Y-axis
medianPlot <- ggplot(data=all.df,aes(x=Date,y=MedianPrice)) + geom_point(size=1) + geom_line() + geom_smooth(aes(y=all.df$MedianPrice)) + theme(axis.text.x = element_text(angle = 60,hjust = 1,vjust = 0.5)) + scale_x_date(date_labels="%b-%Y") + expand_limits(y=0)

# Format X & Y axis labels
medianPlot + xlab("Year") + ylab("Price") + ggtitle(paste(paste("Plot comparing Time vs Price for Airline: ", bestAirline, sep=""), nString, sep=""))
  
```

\newpage

# Implementing Map Reduce Jobs

This program consists of two map-reduce jobs pipelined. 

# First Map Reduce Job

## CarrierCount -- Main class
`CarrierCount` configures the first job 'carrier count' , sets the Mapper class to 'FlightMapper', sets the Reducer class to 'FlightReducer', and sets the input and output paths from the command line arguments.

## FlightMapper -- Mapper Class
This class maps the carriercode and year to the corresponding average price and scheduled flight time. This class will output the intermediate set of key-value pairs where,
key ->  custom combination of flight code and year separated by tab. 
Example, `AA\2014` where `AA` is the carrier code and `2014` is the flight year
value -> `292.33\120` where `292.33` is the Average Price and `120` is the CRS_ElapsedTime

## FlightReducer -- Reducer Class
This class iterates though the iterable array `Iterable<Text>` for all CarrierCode-Year keys. The reduce method then writes the values (Average Price and Flight Time) to an output file.


# Second Map Reduce Job

## PrintPrice -- Main class
`PrintPrice` configures the second job 'print price' , sets the Mapper class to 'FlightMapper', sets the Reducer class to 'FlightReducer', and sets the input and output paths from the command line arguments. This class takes in the cheapest carrier code as an argument, which is set in the configuration parameter.

## PrintPriceMapper -- Mapper Class
This class maps the year to the corresponding average price and week number of the flight. This class will output the intermediate set of key-value pairs where,
key ->  flight year
Example, `2014` where `2014` is the flight year
value -> `292.33\12` where `292.33` is the Average Price and `12` is the week number

## MedianReducer -- Reducer Class
This class iterates though the iterable array `Iterable<Text>` for all Year keys. The reduce method then computes the median over each week for the given year and writes it to the output file. The output file contains the year , week number and median price as tab-separated values.

\newpage

#SYSTEM SPECIFICATION:
```
1. Java 1.7.0_79
2. Ubuntu 14.04 64-bit/ MAC 10.11 64-bit
3. 8GB RAM
4. Pandoc (https://github.com/jgm/pandoc/releases/tag/1.16.0.2)
4. R Packages:
4.1 Rcpp
4.2 R.utils
4.3 ggplot2
4.4 rmarkdown
4.5 plyr
```

# Implementation
```
1. We have implemented two pipelined Map Reduce jobs. In each Map Reduce job :
   The Mapper calls the map method where the record is checked for sanity tests and Intermediate       Key, Value Pairs are sent to the Reducer.
   The Reducer calls the reduce method passing an iterable of values.
2. The first map reduce job outputs the content to a folder called mr1_output.
3. The R script linearReg.R then reads the contents from the output file , runs a linear model         function on the average price and flight scheduled time , and returns the minimum predicted         value. The carrier code corresponding to the minimum predicted value is then written in a file      called best_airline.txt.
4. The second map reduce job outputs the year, week number and median price for this cheapest          airline.
5. The R Markdown document is then run which shows the plot between Price and Year for N=1 and        N=200 and generates the report.
6. Plot is drawn with ggplot2 package.
7. Make file is created to automate all the above steps.
```